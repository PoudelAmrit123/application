name: Building the docker image 

on:
 push:
   branches:
     - dev
env:
  CLERK_PUBLISHABLE_KEY: ${{ vars.CLERK_PUBLISHABLE_KEY }}
  DB_CLIENT: ${{ vars.DB_CLIENT }}
  DB_HOST: ${{ vars.DB_HOST }}
  DB_NAME: ${{ vars.DB_NAME }}
  DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
  DB_PORT: ${{ vars.DB_PORT }}
  DB_USER: ${{ vars.DB_USER }}
  NODE_ENV: ${{ vars.NODE_ENV }}
  VITE_CLERK_PUBLISHABLE_KEY: ${{ vars.VITE_CLERK_PUBLISHABLE_KEY }}
  CLERK_SECRET_KEY: ${{ vars.CLERK_SECRET_KEY }}

jobs:
  frontend:
    runs-on: ubuntu-latest
    # environment: feature
    steps:
      - name: Test
        run: echo "Hello from the frontend"
      - name: Code Cloning to ubuntu
        uses: actions/checkout@v4
      - name: Set up Docker
        uses: docker/setup-docker-action@v4
      - name: Docker login
        uses: docker/login-action@v3
        with:
          username: ${{ vars.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Building the Frontend Image
        run: |
          docker build -t amritpoudel/frontend:${{ github.ref_name }}-${{ github.sha }} --build-arg VITE_CLERK_PUBLISHABLE_KEY=${{ vars.VITE_CLERK_PUBLISHABLE_KEY }} ./frontend

          docker tag amritpoudel/frontend:${{ github.ref_name }}-${{ github.sha }} amritpoudel/frontend:1.0.0

          docker push amritpoudel/frontend:1.0.0

  backend1:
    runs-on: ubuntu-latest
    # environment: feature
    steps:
      - name: Test
        run: echo "Hello from the backend"
      - name: Code Cloning to ubuntu
        uses: actions/checkout@v4
      - name: Set up Docker
        uses: docker/setup-docker-action@v4
      - name: Docker login
        uses: docker/login-action@v3
        with:
          username: ${{ vars.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Building the Backend Image
        run: |
          docker build -t amritpoudel/backend1:${{ github.ref_name }}-${{ github.sha }} --build-arg VITE_CLERK_PUBLISHABLE_KEY=${{ vars.VITE_CLERK_PUBLISHABLE_KEY }} ./backend1

          docker tag amritpoudel/backend1:${{ github.ref_name }}-${{ github.sha }} amritpoudel/backend1:1.0.0

          docker push amritpoudel/backend1:1.0.0
        
  backend2:
    runs-on: ubuntu-latest
    # environment: feature
    steps:
      - name: Test
        run: echo "Hello from the backend"
      - name: Code Cloning to ubuntu
        uses: actions/checkout@v4
      - name: Set up Docker
        uses: docker/setup-docker-action@v4
      - name: Docker login
        uses: docker/login-action@v3
        with:
          username: ${{ vars.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Building the Backend Image
        run: |
          docker build -t amritpoudel/backend2:${{ github.ref_name }}-${{ github.sha }} --build-arg VITE_CLERK_PUBLISHABLE_KEY=${{ vars.VITE_CLERK_PUBLISHABLE_KEY }} ./backend2

          docker tag amritpoudel/backend2:${{ github.ref_name }}-${{ github.sha }} amritpoudel/backend2:1.0.0

          docker push amritpoudel/backend2:1.0.0
          


         
  

 